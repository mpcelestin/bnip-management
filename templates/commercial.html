{% extends "base.html" %}

{% block content %}
<div class="user-container">
    <h2>CHEF COMERCIAL Dashboard</h2>
    
    <div class="report-form">
        <h3>Submit New Report</h3>
        <form method="POST" action="{{ url_for('commercial') }}" onsubmit="calculateTotal()">
            <div class="form-group">
                <label for="type_produit">TYPE DE PRODUIT VENDUS AUJOURD'HUI:</label>
                <input type="text" id="type_produit" name="type_produit" required>
            </div>
            <div class="form-group">
                <label for="nombre_produit">NOMBRE DE PRODUIT VENDUS AUJOURD'HUI:</label>
                <input type="number" id="nombre_produit" name="nombre_produit" required>
            </div>
            <div class="form-group">
                <label for="prix_unitaire">PRIX UNITAIRE (BIF):</label>
                <input type="number" id="prix_unitaire" name="prix_unitaire" required>
            </div>
            <div class="form-group">
                <label for="valeur_total">VALEUR TOTAL EN BIF:</label>
                <input type="number" id="valeur_total" name="valeur_total" readonly required>
            </div>
            <button type="submit" class="btn">Envoyer le rapport</button>
        </form>
    </div>
    
    <div class="reports-history">
        <h3>Your Reports History</h3>
        <table class="reports-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Data</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>{{ report.date.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td class="report-data">
                        <div><strong>Type:</strong> {{ report.data.type_produit }}</div>
                        <div><strong>Quantit√©:</strong> {{ report.data.nombre_produit }}</div>
                        <div><strong>Prix unitaire:</strong> {{ report.data.prix_unitaire }} BIF</div>
                        <div><strong>Valeur totale:</strong> {{ report.data.valeur_total }} BIF</div>
                    </td>
                    <td>
                        {% if report.date.date() == now.date() %}
                        <form action="{{ url_for('delete_report', report_id=report.id) }}" method="POST">
                            <button type="submit" class="btn-danger">Delete</button>
                        </form>
                        {% else %}
                        <span class="disabled-action">Cannot edit</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function calculateTotal() {
    const quantity = parseFloat(document.getElementById('nombre_produit').value) || 0;
    const unitPrice = parseFloat(document.getElementById('prix_unitaire').value) || 0;
    const totalValue = quantity * unitPrice;
    document.getElementById('valeur_total').value = totalValue.toFixed(2);
}

// Auto-calculate when inputs change
document.getElementById('nombre_produit').addEventListener('input', calculateTotal);
document.getElementById('prix_unitaire').addEventListener('input', calculateTotal);
</script>
{% endblock %}